{"version":3,"sources":["assets/scripts/game.js"],"names":["cc","Class","Component","properties","board","Node","bomb1","bomb2","bomb3","dialogPrefab","Prefab","ruleWindow","bgClip","type","AudioClip","loseClip","winClip","switchActive","e","number","bombActive","bombCount","resources","load","err","prefab","bombBox","forEach","bomb","idx","border","getChildByName","stopAllActions","tween","to","angle","start","removeAllChildren","addChild","instantiate","bg","ctx","getComponent","Graphics","clear","fillColor","circle","fill","content","contentImg","scale","color","Color","contentCount","Label","fontSize","repeatForever","minusBombCount","upgradeBombCount","nextIdx","findIndex","n","gameOver","currentCount","string","status","gameStatus","boardScript","overHandler","dialog","node","audioEngine","play","dialogScript","setContent","setCallback","director","loadScene","backToIntro","replay","ruleDisplay","active","Animation","ruleHidden","onLoad","clipId","setGetActiveBombHandler","setGameStatusHandler","bind","setMinusBombCountHandler","startHandler","onDestroy","stop"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n  extends: cc.Component,\n\n  properties: {\n    board: cc.Node,\n    bomb1: cc.Node,\n    bomb2: cc.Node,\n    bomb3: cc.Node,\n    dialogPrefab: cc.Prefab,\n    ruleWindow: cc.Node,\n    bgClip: {\n      default: null,\n      type: cc.AudioClip,\n    },\n    loseClip: {\n      default: null,\n      type: cc.AudioClip,\n    },\n    winClip: {\n      default: null,\n      type: cc.AudioClip,\n    },\n  },\n\n  switchActive(e, number) {\n    number = +number\n    if (number === this.bombActive) return\n\n    if (this.bombCount[number] === 0) return\n\n    cc.resources.load(\"prefab/bomb_normal\", cc.Prefab, (err, prefab) => {\n      this.bombBox.forEach((bomb, idx) => {\n        if (idx === 0 || idx === number) return\n        let border = bomb.getChildByName(\"bottom_flex__item__border\")\n        /** 停止所有動作 */\n        border.stopAllActions()\n        /** 校正角度 */\n        cc.tween(border).to(0, { angle: 0 }).start()\n        border.removeAllChildren()\n        border.addChild(cc.instantiate(prefab))\n\n        let bg = bomb.getChildByName(\"bottom_flex__item__bg\")\n        let ctx = bg.getComponent(cc.Graphics)\n        ctx.clear()\n        ctx.fillColor = \"#0BA390\"\n        ctx.circle(0, -2, 55)\n        ctx.fill()\n\n        let content = bomb.getChildByName(\"bottom_flex__item__content\")\n        let contentImg = content.getChildByName(\"bomb_img\")\n\n        contentImg.scale = 0.8\n        contentImg.color = new cc.Color(136, 136, 136)\n\n        let contentCount = content.getChildByName(\"bomb_count\")\n        contentCount.getComponent(cc.Label).fontSize = 16\n        contentCount.color = new cc.Color(136, 136, 136)\n      })\n    })\n\n    cc.resources.load(\"prefab/bomb_active\", cc.Prefab, (err, prefab) => {\n      this.bombBox.forEach((bomb, idx) => {\n        if (idx !== 0 && idx === number) {\n          let border = bomb.getChildByName(\"bottom_flex__item__border\")\n          border.removeAllChildren()\n          border.addChild(cc.instantiate(prefab))\n          // border.runAction(cc.repeatForever(cc.rotateBy(7, 360)))\n          cc.tween(border)\n            .repeatForever(cc.tween().to(7, { angle: 360 }))\n            .start()\n\n          let bg = bomb.getChildByName(\"bottom_flex__item__bg\")\n          let ctx = bg.getComponent(cc.Graphics)\n          ctx.clear()\n          ctx.fillColor = \"#A2F7EC\"\n          ctx.circle(0, 0, 65)\n          ctx.fill()\n\n          let content = bomb.getChildByName(\"bottom_flex__item__content\")\n          let contentImg = content.getChildByName(\"bomb_img\")\n          contentImg.scale = 1\n          contentImg.color = new cc.Color(255, 255, 255)\n          let contentCount = content.getChildByName(\"bomb_count\")\n          contentCount.getComponent(cc.Label).fontSize = 20\n          contentCount.color = new cc.Color(255, 255, 255)\n        }\n      })\n    })\n\n    this.bombActive = number\n  },\n\n  minusBombCount() {\n    this.bombCount[this.bombActive] -= 1\n    this.upgradeBombCount()\n    if (this.bombCount[this.bombActive] === 0) {\n      let nextIdx = this.bombCount.findIndex((n) => n > 0)\n      if (nextIdx >= 0) this.switchActive(null, nextIdx)\n      else this.gameOver(\"lose\")\n    }\n  },\n\n  upgradeBombCount() {\n    this.bombBox.forEach((bomb, idx) => {\n      if (idx !== 0) {\n        let currentCount = this.bombCount[idx]\n        let content = bomb.getChildByName(\"bottom_flex__item__content\")\n        let contentCount = content.getChildByName(\"bomb_count\")\n        contentCount.getComponent(cc.Label).string = \"x \" + currentCount\n      }\n    })\n  },\n\n  gameOver(status) {\n    if (this.gameStatus !== \"playing\") return false\n\n    this.gameStatus = status\n    this.boardScript.overHandler()\n\n    let dialog = cc.instantiate(this.dialogPrefab)\n    this.node.addChild(dialog)\n\n    if (status === \"lose\") cc.audioEngine.play(this.loseClip, false, 1)\n    else cc.audioEngine.play(this.winClip, false, 1)\n\n    let dialogScript = dialog.getComponent(\"dialog\")\n    dialogScript.setContent(\"you \" + status + \"! replay?\")\n    dialogScript.setCallback(() => cc.director.loadScene(\"game\"))\n  },\n\n  backToIntro() {\n    let dialog = cc.instantiate(this.dialogPrefab)\n    this.node.addChild(dialog)\n    let dialogScript = dialog.getComponent(\"dialog\")\n    dialogScript.setContent(\"You really want to go ahead?\")\n    dialogScript.setCallback(() => cc.director.loadScene(\"intro\"))\n  },\n\n  replay() {\n    let dialog = cc.instantiate(this.dialogPrefab)\n    this.node.addChild(dialog)\n    let dialogScript = dialog.getComponent(\"dialog\")\n    dialogScript.setContent(\"Replay?\")\n    dialogScript.setCallback(() => cc.director.loadScene(\"game\"))\n  },\n\n  ruleDisplay() {\n    this.ruleWindow.active = true\n    this.ruleWindow.getComponent(cc.Animation).play(\"slice-in\")\n  },\n\n  ruleHidden() {\n    this.ruleWindow.getComponent(cc.Animation).play(\"slice-out\")\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    this.clipId = cc.audioEngine.play(this.bgClip, true, 0.5)\n    this.bombActive = 0\n    this.bombBox = [, this.bomb1, this.bomb2, this.bomb3]\n    this.bombCount = [, 26, 3, 1]\n    this.gameStatus = \"playing\"\n    this.boardScript = this.board.getComponent(\"board\")\n    this.upgradeBombCount()\n  },\n\n  start() {\n    this.switchActive(null, 1)\n    this.boardScript.setGetActiveBombHandler(() => this.bombActive)\n    this.boardScript.setGameStatusHandler(this.gameOver.bind(this))\n    this.boardScript.setMinusBombCountHandler(this.minusBombCount.bind(this))\n    this.boardScript.startHandler()\n  },\n\n  onDestroy() {\n    cc.audioEngine.stop(this.clipId)\n  },\n  // update (dt) {},\n})\n"]}